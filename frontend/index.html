<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container-fluid { padding: 0; }
        .sidebar { background-color: #343a40; color: white; padding: 20px; min-height: calc(100vh - 56px); }
        .sidebar .list-group-item { background-color: #343a40; color: white; border: none; padding: 10px 15px; }
        .sidebar .list-group-item.active { background-color: #007bff; }
        .sidebar .list-group-item:hover { background-color: #495057; }
        .main-content { padding: 20px; }
        .card { border: none; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .card-header { background-color: #007bff; color: white; border-radius: 10px 10px 0 0; padding: 15px 20px; }
        .card-body { padding: 20px; }
        .btn-primary { background-color: #007bff; border-color: #007bff; }
        .btn-primary:hover { background-color: #0056b3; border-color: #0056b3; }
        .btn-danger { background-color: #dc3545; border-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; border-color: #c82333; }
        .btn-warning { background-color: #ffc107; border-color: #ffc107; color: #212529; }
        .btn-warning:hover { background-color: #e0a800; border-color: #e0a800; }
        .btn-info { background-color: #17a2b8; border-color: #17a2b8; }
        .btn-info:hover { background-color: #138496; border-color: #138496; }
        input[type="text"], input[type="password"], input[type="number"] { margin-bottom: 15px; }
        .error { color: #dc3545; font-weight: bold; }
        .success { color: #28a745; font-weight: bold; }
        #dashboardSection { display: none; }
        .table thead { background-color: #e9ecef; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <button class="btn btn-outline-light me-2" onclick="toggleSidebar()" id="sidebarToggleBtn" style="display:none;">&#9776;</button>
            <a class="navbar-brand" href="#">User Management</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-light me-2" onclick="handleLogout()" id="logoutBtn" style="display:none;">Logout</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <h4 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                        <span>Services</span>
                    </h4>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span data-feather="file"></span>
                                Inventory
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span data-feather="shopping-cart"></span>
                                Item
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <span data-feather="users"></span>
                                Order
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#" onclick="showDashboard('Welcome'); return false;">
                                <span data-feather="home"></span>
                                User Service
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="main-content" id="mainContent">
                <h1 class="mb-4 text-center">User Management System</h1>
                
                <div class="container py-4">
                    <div class="row justify-content-center">
                        <div class="col-md-6 col-lg-5">
                            <div id="loginSection" class="card">
                                <div class="card-header">
                                    <h2 class="mb-0">Login</h2>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="loginNama" placeholder="Nama" required>
                                    </div>
                                    <div class="mb-3">
                                        <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
                                    </div>
                                    <button class="btn btn-primary me-2" onclick="handleLogin()">Login</button>
                                    <button class="btn btn-info" onclick="showRegister()">Register</button>
                                    <div id="loginStatus" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container py-4">
                    <div class="row justify-content-center">
                        <div class="col-md-6 col-lg-5">
                            <div id="registerSection" class="card" style="display: none;">
                                <div class="card-header">
                                    <h2 class="mb-0">Register New User</h2>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="registerNama" placeholder="Nama" required>
                                    </div>
                                    <div class="mb-3">
                                        <input type="password" class="form-control" id="registerPassword" placeholder="Password" required>
                                    </div>
                                    <button class="btn btn-primary me-2" onclick="handleRegister()">Register</button>
                                    <button class="btn btn-secondary" onclick="showLogin()">Back to Login</button>
                                    <div id="registerStatus" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="dashboardSection">
                    <div class="container py-4">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-8">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h2 class="mb-0">Welcome, <span id="loggedInUserName"></span>!</h2>
                                    </div>
                                    <div class="card-body">
                                        <p>This is your user management dashboard. You can add, view, update, and delete users here.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-8">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h2 class="mb-0">Add User</h2>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <input type="text" class="form-control" id="userName" placeholder="Name" required>
                                                </div>
                                                <div class="mb-3">
                                                    <input type="password" class="form-control" id="userPassword" placeholder="Password" required>
                                                </div>
                                                <button class="btn btn-primary" onclick="addUser()">Add User</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <h2 class="mb-0">User List</h2>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAllUsers()">Delete All Users</button>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-striped">
                                                        <thead>
                                                            <tr>
                                                                <th>ID</th>
                                                                <th>Nama</th>
                                                                <th>Password</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="userList">
                                                            <!-- User data will be displayed here -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <button class="btn btn-secondary mt-3" onclick="fetchUsers()">Refresh List</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Custom Alert Modal -->
    <div class="modal fade" id="customAlertModal" tabindex="-1" aria-labelledby="customAlertModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customAlertModalLabel">Pesan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="customAlertModalBody">
                    <!-- Message will be inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editUserId">
                    <div class="mb-3">
                        <label for="editUserName" class="form-label">Nama</label>
                        <input type="text" class="form-control" id="editUserName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editUserPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="editUserPassword" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="handleEditUserSave()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">Konfirmasi Hapus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="deleteConfirmModalBody">
                    Apakah Anda yakin ingin menghapus user ini?
                    <input type="hidden" id="deleteUserIdConfirm">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" onclick="handleDeleteUserConfirm()">Hapus</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete All Confirmation Modal -->
    <div class="modal fade" id="deleteAllConfirmModal" tabindex="-1" aria-labelledby="deleteAllConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteAllConfirmModalLabel">Konfirmasi Hapus Semua</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Apakah Anda yakin ingin menghapus SEMUA user? Tindakan ini tidak bisa dibatalkan.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" onclick="handleDeleteAllUsersConfirm()">Hapus Semua</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const GRAPHQL_URL = 'http://localhost:5003/graphql';
        let loggedInUserNameGlobal = ''; // Declare global variable for logged in user name

        // Function to show custom alert modal
        function showCustomAlert(message, type = 'info') {
            const modalElement = document.getElementById('customAlertModal');
            const modalBody = document.getElementById('customAlertModalBody');
            
            // Clear previous classes
            modalBody.classList.remove('text-success', 'text-danger', 'text-info');

            // Add class based on type
            if (type === 'success') {
                modalBody.classList.add('text-success');
            } else if (type === 'error') {
                modalBody.classList.add('text-danger');
            } else {
                modalBody.classList.add('text-info');
            }
            
            modalBody.textContent = message;
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        }

        // Function to show edit user modal
        function showEditUserModal(id, nama, password) {
            document.getElementById('editUserId').value = id;
            document.getElementById('editUserName').value = nama;
            document.getElementById('editUserPassword').value = password;
            const editModal = new bootstrap.Modal(document.getElementById('editUserModal'));
            editModal.show();
        }

        // Function to show delete confirmation modal
        function showDeleteConfirmModal(id) {
            document.getElementById('deleteUserIdConfirm').value = id;
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
            deleteModal.show();
        }

        // Function to show delete all users confirmation modal
        function showDeleteAllUsersConfirmModal() {
            const deleteAllModal = new bootstrap.Modal(document.getElementById('deleteAllConfirmModal'));
            deleteAllModal.show();
        }

        function updateLogoutButtonVisibility() {
            const logoutBtn = document.getElementById('logoutBtn');
            const sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
            const dashboardSection = document.getElementById('dashboardSection');
            if (dashboardSection.style.display === 'block') {
                logoutBtn.style.display = 'block';
                sidebarToggleBtn.style.display = 'block'; // Show toggle button
            } else {
                logoutBtn.style.display = 'none';
                sidebarToggleBtn.style.display = 'none'; // Hide toggle button
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebarMenu');
            const mainContent = document.getElementById('mainContent');

            if (sidebar.classList.contains('d-none')) {
                // Show sidebar
                sidebar.classList.remove('d-none');
                sidebar.classList.add('d-md-block');
                mainContent.classList.remove('col-md-12'); // Remove full width class for dashboard
                mainContent.classList.add('col-md-9', 'ms-sm-auto', 'col-lg-10', 'px-md-4'); // Add sidebar-aware classes
            } else {
                // Hide sidebar
                sidebar.classList.remove('d-md-block');
                sidebar.classList.add('d-none');
                mainContent.classList.remove('col-md-9', 'ms-sm-auto', 'col-lg-10', 'px-md-4'); // Remove sidebar-aware classes
                mainContent.classList.add('col-md-12'); // Add full width class for dashboard
            }
        }

        function showLogin() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('registerSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('sidebarMenu').classList.remove('d-md-block');
            document.getElementById('sidebarMenu').classList.add('d-none');
            updateLogoutButtonVisibility();
        }

        function showRegister() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('registerSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('sidebarMenu').classList.remove('d-md-block');
            document.getElementById('sidebarMenu').classList.add('d-none');
            updateLogoutButtonVisibility();
        }

        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('registerSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
            document.getElementById('sidebarMenu').classList.remove('d-none');
            document.getElementById('sidebarMenu').classList.add('d-md-block');
            document.getElementById('loggedInUserName').textContent = loggedInUserNameGlobal || 'User';
            fetchUsers(); // Load users after login
            updateLogoutButtonVisibility();
        }

        function handleLogout() {
            loggedInUserNameGlobal = ''; // Clear user name on logout
            showCustomAlert('Logged out successfully!', 'success');
            showLogin();
        }

        async function handleLogin() {
            const nama = document.getElementById('loginNama').value;
            const password = document.getElementById('loginPassword').value;
            const statusDiv = document.getElementById('loginStatus');

            if (!nama || !password) {
                statusDiv.innerHTML = '<p class="error">Please fill in all fields</p>';
                return;
            }

            const mutation = `
                mutation {
                    loginUser(nama: "${nama}", password: "${password}") {
                        user {
                            id
                            nama
                        }
                    }
                }
            `;

            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                loggedInUserNameGlobal = data.data.loginUser.user.nama; // Store logged in user name
                showCustomAlert('Login successful!', 'success');
                showDashboard();
            } catch (error) {
                console.error('Login failed:', error);
                showCustomAlert(`Login failed: ${error.message}`, 'error');
            }
        }

        async function handleRegister() {
            const nama = document.getElementById('registerNama').value;
            const password = document.getElementById('registerPassword').value;
            const statusDiv = document.getElementById('registerStatus');

            if (!nama || !password) {
                statusDiv.innerHTML = '<p class="error">Please fill in all fields</p>';
                return;
            }

            const mutation = `
                mutation {
                    createUser(nama: "${nama}", password: "${password}") {
                        user {
                            id
                            nama
                        }
                    }
                }
            `;

            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                showCustomAlert('Registration successful! Please login.', 'success');
                document.getElementById('registerNama').value = '';
                document.getElementById('registerPassword').value = '';
                showLogin();
            } catch (error) {
                console.error('Registration failed:', error);
                showCustomAlert(`Registration failed: ${error.message}`, 'error');
            }
        }

        async function fetchUsers() {
            const userList = document.getElementById('userList');
            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query {
                                allUsers {
                                    id
                                    nama
                                    password
                                }
                            }
                        `
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                const users = data.data.allUsers;
                userList.innerHTML = ''; // Clear existing content
                if (users.length === 0) {
                    userList.innerHTML = '<tr><td colspan="4" class="text-center">No users found.</td></tr>';
                } else {
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.id}</td>
                            <td>${user.nama}</td>
                            <td>${user.password}</td>
                            <td>
                                <button class="btn btn-warning btn-sm me-2" onclick="editUser(${user.id}, '${user.nama}', '${user.password}')">Edit</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
                            </td>
                        `;
                        userList.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Fetch users failed:', error);
                userList.innerHTML = `<tr><td colspan="4" class="error">Error: ${error.message}</td></tr>`;
            }
        }

        async function addUser() {
            const nama = document.getElementById('userName').value;
            const password = document.getElementById('userPassword').value;

            if (!nama || !password) {
                showCustomAlert('Please fill in all fields', 'error');
                return;
            }

            const mutation = `
                mutation {
                    createUser(nama: "${nama}", password: "${password}") {
                        user {
                            id
                            nama
                            password
                        }
                    }
                }
            `;

            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                showCustomAlert('User added successfully!', 'success');
                document.getElementById('userName').value = '';
                document.getElementById('userPassword').value = '';
                fetchUsers();
            } catch (error) {
                console.error('Add user failed:', error);
                showCustomAlert(`Add user failed: ${error.message}`, 'error');
            }
        }

        async function editUser(id, currentNama, currentPassword) {
            showEditUserModal(id, currentNama, currentPassword);
        }

        async function handleEditUserSave() {
            const id = document.getElementById('editUserId').value;
            const newNama = document.getElementById('editUserName').value;
            const newPassword = document.getElementById('editUserPassword').value;

            if (!newNama || !newPassword) {
                showCustomAlert('Name and password cannot be empty.', 'error');
                return;
            }

            const mutation = `
                mutation {
                    updateUser(id: ${id}, nama: "${newNama}", password: "${newPassword}") {
                        user {
                            id
                            nama
                            password
                        }
                    }
                }
            `;

            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                showCustomAlert('User updated successfully!', 'success');
                // Hide the edit modal manually after save
                const editModalElement = document.getElementById('editUserModal');
                const editModal = bootstrap.Modal.getInstance(editModalElement);
                if (editModal) {
                    editModal.hide();
                }
                fetchUsers();
            } catch (error) {
                console.error('Update user failed:', error);
                showCustomAlert(`Update user failed: ${error.message}`, 'error');
            }
        }

        async function deleteUser(id) {
            showDeleteConfirmModal(id);
        }

        async function handleDeleteUserConfirm() {
            const id = document.getElementById('deleteUserIdConfirm').value;
            
            const mutation = `
                mutation {
                    deleteUser(id: ${id}) {
                        success
                    }
                }
            `;

            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                // Hide the delete confirmation modal
                const deleteModalElement = document.getElementById('deleteConfirmModal');
                const deleteModal = bootstrap.Modal.getInstance(deleteModalElement);
                if (deleteModal) {
                    deleteModal.hide();
                }

                if (data.data.deleteUser.success) {
                    showCustomAlert('User deleted successfully!', 'success');
                    fetchUsers();
                } else {
                    showCustomAlert('Failed to delete user.', 'error');
                }
            } catch (error) {
                console.error('Delete user failed:', error);
                showCustomAlert(`Delete user failed: ${error.message}`, 'error');
            }
        }

        async function deleteAllUsers() {
            showDeleteAllUsersConfirmModal();
        }

        async function handleDeleteAllUsersConfirm() {
            const mutation = `
                mutation {
                    deleteAllUsers {
                        success
                    }
                }
            `;

            try {
                const response = await fetch(GRAPHQL_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.errors[0].message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }

                // Hide the delete all confirmation modal
                const deleteAllModalElement = document.getElementById('deleteAllConfirmModal');
                const deleteAllModal = bootstrap.Modal.getInstance(deleteAllModalElement);
                if (deleteAllModal) {
                    deleteAllModal.hide();
                }

                if (data.data.deleteAllUsers.success) {
                    showCustomAlert('All users deleted successfully!', 'success');
                    fetchUsers();
                } else {
                    showCustomAlert('Failed to delete all users.', 'error');
                }
            } catch (error) {
                console.error('Delete all users failed:', error);
                showCustomAlert(`Delete all users failed: ${error.message}`, 'error');
            }
        }

        // Initialize to show login section
        showLogin();
    </script>
</body>
</html> 